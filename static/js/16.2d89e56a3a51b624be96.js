webpackJsonp([16],{AARu:function(e,t){},BBrw:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("//Fk"),n=i.n(s),r=i("BO1k"),o=i.n(r),a=i("mvHQ"),c=i.n(a),h=i("Dd8w"),l=i.n(h),p=i("6lvc"),u=i.n(p),d=i("HQei"),E=i("NYxO"),m={name:"jifang",data:function(){return{backgroundImage:u.a,container:Math.random().toString(36).substr(2),camera:null,scene:null,renderer:null,mesh:null,keyboard:new KeyboardState,controls:null,targetList:[],projector:null,SCREEN_WIDTH:0,SCREEN_HEIGHT:0,mouse:{x:0,y:0}}},mixins:[d.a],computed:{showType:function(){return this.$route.params.type?this.$route.params.type:"东莞"}},methods:l()({},Object(E.b)(["setTheRouterStatus"]),{useTheTestDate:function(){},init:function(e){var t=document.getElementById(this.container);this.scene=new THREE.Scene,this.SCREEN_WIDTH=t.clientWidth,this.SCREEN_HEIGHT=t.clientHeight,this.camera=new THREE.PerspectiveCamera(100,t.clientWidth/t.clientHeight,.1,2e3),this.camera.position.set(0,300,550),this.camera.lookAt(this.scene.position),this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setClearColor(0,0),this.renderer.setSize(t.clientWidth,t.clientHeight),t.appendChild(this.renderer.domElement);var i=new THREE.DirectionalLight(16777215,.3);i.color.setHSL(.1,1,.95),i.position.set(0,200,0).normalize(),this.scene.add(i);var s=new THREE.AmbientLight(16777215,1);s.position.set(0,0,0),this.scene.add(s),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.initModel(e),this.projector=new THREE.Projector,document.addEventListener("mousedown",this.onDocumentMouseDown,!1),document.addEventListener("mousemove",this.onDocumentMouseMove,!1)},update:function(){this.keyboard.update(),(this.keyboard.pressed("left")||this.keyboard.pressed("A"))&&this.camera.translateX(-5),(this.keyboard.pressed("right")||this.keyboard.pressed("D"))&&this.camera.translateX(5),(this.keyboard.pressed("up")||this.keyboard.pressed("W"))&&this.camera.translateZ(-5),(this.keyboard.pressed("down")||this.keyboard.pressed("S"))&&this.camera.translateZ(5),this.keyboard.pressed("R")&&this.camera.translateY(-5),this.keyboard.pressed("F")&&this.camera.translateY(5),this.keyboard.pressed("Q")&&this.controls.pan(new THREE.Vector3(-10,0,0)),this.keyboard.pressed("E")&&this.controls.pan(new THREE.Vector3(10,0,0)),this.controls.update()},animate:function(){requestAnimationFrame(this.animate),this.renderer.render(this.scene,this.camera),this.update()},initBase:function(){this.createFloor(1200,500);var e=this.createCubeWall(1200,130,0,65,250,0,0,0,"墙面"),t=this.createCubeWall(100,128,0,31,250,0,0,0,"门"),i=this.createCubeWindow(250,130,-275,65,250,0,0,0,"窗户"),s=this.createCubeWindow(250,130,275,65,250,0,0,0,"窗户"),n=[];n.push(t),n.push(i),n.push(s);var r=this.createResultBsp(e,n);this.scene.add(r),this.scene.add(i),this.scene.add(s),this.createDoor_left(100,100,0,0,-50,50,250,0,"左门");var o=this.createCubeWall(1200,130,0,65,-250,0,0,0,"墙面"),a=this.createCubeWindow(924,130,0,65,-250,0,0,0,"窗户"),c=[];c.push(a);var h=this.createResultBsp(o,c);this.scene.add(h),this.scene.add(a);var l=this.createCubeWall(500,130,600,65,0,0,Math.PI/2,0,"墙面"),p=this.createCubeWindow(400,130,600,65,0,0,Math.PI/2,0,"窗户"),u=[];u.push(p);var d=this.createResultBsp(l,u);this.scene.add(d),this.scene.add(p);var E=this.createCubeWall(500,130,-600,65,0,0,Math.PI/2,0,"墙面"),m=this.createCubeWindow(400,130,-600,65,0,0,Math.PI/2,0,"窗户"),v=[];v.push(m);var T=this.createResultBsp(E,v);this.scene.add(T),this.scene.add(m)},initModel:function(e){this.initBase();for(var t=0;t<e.length;t++){var i=e[t];this.createCabinet(i.size.w,i.servers.length>7?10*i.servers.length:i.size.h,i.size.d,i.position.x,i.position.y,i.position.z,i)}},createFloor:function(e,t){var i=new THREE.ImageUtils.loadTexture("./static/image/anliyulinggan.jpeg");i.wrapS=i.wrapT=THREE.RepeatWrapping,i.repeat.set(8,8);var s=new THREE.PlaneGeometry(e,t),n=new THREE.MeshBasicMaterial({map:i,side:THREE.DoubleSide});n.opacity=1,n.transparent=!0;var r=new THREE.Mesh(s,n);r.position.y=0,r.rotation.x=Math.PI/2,this.scene.add(r)},createCubeWall:function(e,t,i,s,n,r,o,a,c){var h=new THREE.BoxGeometry(e,t,5),l=new THREE.MeshBasicMaterial({color:10269393,opacity:.4,transparent:!1,side:THREE.DoubleSide}),p=new THREE.Mesh(h,l);return p.position.x=i,p.position.y=s,p.position.z=n,p.rotation.y=o,p.name=c,p},createCubeWindow:function(e,t,i,s,n,r,o,a,c){var h=new THREE.BoxGeometry(e,t,5),l=new THREE.MeshBasicMaterial({color:13107,opacity:.5,transparent:!0}),p=new THREE.Mesh(h,l);return p.position.x=i,p.position.y=s,p.position.z=n,p.rotation.y=o,p.name=c,p},createDoor_left:function(e,t,i,s,n,r,o,a){var c=this;(new THREE.TextureLoader).load("./static/image/door.png",function(i){i.minFilter=THREE.LinearFilter;var h=new THREE.BoxGeometry(e,t,5);h.translate(50,0,0);var l=new THREE.MeshBasicMaterial({map:i,color:16777215});l.opacity=1,l.transparent=!0;var p=new THREE.Mesh(h,l);p.position.set(n,r,o),p.rotation.y+=s*Math.PI,p.name=a,c.scene.add(p)})},createResultBsp:function(e,t){for(var i=new THREE.MeshPhongMaterial({color:10269393,specular:10269393,shininess:30,transparent:!0,opacity:1}),s=new ThreeBSP(e),n=0;n<t.length;n++){var r=new ThreeBSP(t[n]);s=s.subtract(r)}var o=s.toMesh(i);return o.material.flatshading=THREE.FlatShading,o.geometry.computeFaceNormals(),o.geometry.computeVertexNormals(),o.material.needsUpdate=!0,o.geometry.buffersNeedUpdate=!0,o.geometry.uvsNeedUpdate=!0,o},createCabinet:function(e,t,i,s,n,r,o){var a=t,h=this,l={};l.info=JSON.parse(c()(o));var p=new THREE.BoxGeometry(e,a,2),u=new THREE.MeshBasicMaterial({color:7829367,opacity:.2,transparent:!0}),d=new THREE.Mesh(p,u);d.position.x=s,d.position.y=n+a/2+1,d.position.z=r-i/2+2,d.container=l,this.targetList.push(d),this.scene.add(d),l.back=d;p=new THREE.BoxGeometry(e,a,2),u=new THREE.MeshBasicMaterial({color:7829367,opacity:.9,transparent:!0});var E=new THREE.Mesh(p,u),m=new THREE.Mesh(p,u);E.position.x=s+e/2-1,E.position.y=n+a/2+1,E.position.z=r,E.rotation.y=Math.PI/2,m.position.x=s-e/2+1,m.position.y=n+a/2+1,m.position.z=r,m.rotation.y=-Math.PI/2,E.container=l,m.container=l,this.targetList.push(E),this.targetList.push(m),this.scene.add(E),this.scene.add(m),l.left=E,l.right=m;p=new THREE.BoxGeometry(e,2,i),u=new THREE.MeshBasicMaterial({color:2236962,transparent:!0});var v=new THREE.Mesh(p,u),T=new THREE.Mesh(p,u);v.position.x=s,v.position.y=n+a+2,v.position.z=r,T.position.x=s,T.position.y=n+2,T.position.z=r,v.container=l,T.container=l,this.targetList.push(v),this.targetList.push(T),this.scene.add(v),this.scene.add(T),l.top=v,l.bottom=T;p=new THREE.BoxGeometry(e,a,2),u=new THREE.MeshBasicMaterial({color:13107,opacity:.5,transparent:!0});var g=new THREE.Mesh(p,u);if(g.position.x=s,g.position.y=n+a/2+1,g.position.z=r+i/2,g.toggle=function(t){if(0===t.rotation.y)t.rotation.y=t.rotation.y+3*Math.PI/5,t.position.x=t.position.x+e/2+3,t.position.z=t.position.z+i/2,h.openCabinet(t.container);else{t.rotation.y=t.rotation.y-3*Math.PI/5,t.position.x=t.position.x-e/2-3,t.position.z=t.position.z-i/2;for(var s=0;s<t.container.servers.length;s++)t.container.servers[s].toggle(t.container.servers[s],!1);h.closeCabinet(t.container)}},g.container=l,this.scene.add(g),this.targetList.push(g),l.front=g,l.servers=[],o&&o.servers){l.info=o;for(var w=0;w<o.servers.length;w++){var R=this.createServer(e-4,4,i-4,s,n+9*(w+1),r+2,o.servers[w].device.status);R.container=l,R.info=o.servers[w],l.servers.push(R)}}return l},createServer:function(e,t,i,s,n,r){var o=this,a=0===(arguments.length>6&&void 0!==arguments[6]?arguments[6]:0)?"./static/image/server.png":"./static/image/serverError.png",c=new THREE.ImageUtils.loadTexture(a);c.wrapS=c.wrapT=THREE.ClampToEdgeWrapping,c.repeat.set(1,1);var h=new THREE.ImageUtils.loadTexture("./static/image/server-back.png");h.wrapS=h.wrapT=THREE.ClampToEdgeWrapping,h.repeat.set(1,1);var l=new THREE.BoxGeometry(e,t,i),p=[];p.push(new THREE.MeshBasicMaterial({color:12303291})),p.push(new THREE.MeshBasicMaterial({color:12303291})),p.push(new THREE.MeshBasicMaterial({color:12303291})),p.push(new THREE.MeshBasicMaterial({color:12303291})),p.push(new THREE.MeshBasicMaterial({map:c})),p.push(new THREE.MeshBasicMaterial({map:h}));var u=new THREE.MeshFaceMaterial(p),d=new THREE.Mesh(l,u);return d.position.x=s,d.position.y=n,d.position.z=r,d.toggle=function(e,t){for(var s=0;s<e.container.servers.length;s++)e!==e.container.servers[s]&&(e.container.servers[s].position.z===r||(e.container.servers[s].position.z=e.container.servers[s].position.z-i/2,o.closeServer(e.container.servers[s])));e.position.z===r?(null==t||t)&&(e.position.z=e.position.z+i/2,o.openServer(e)):null!==t&&t||(e.position.z=e.position.z-i/2,o.closeServer(e))},d.hover=function(e){o.hoverServer(e)},this.scene.add(d),this.targetList.push(d),d},onDocumentMouseMove:function(e){this.mouse.x=e.clientX/this.SCREEN_WIDTH*2-1,this.mouse.y=-e.clientY/this.SCREEN_HEIGHT*2+1;var t=new THREE.Vector3(this.mouse.x,this.mouse.y,1).unproject(this.camera);new THREE.Raycaster(this.camera.position,t.sub(this.camera.position).normalize()).intersectObjects(this.targetList).length},onDocumentMouseDown:function(e){this.mouse.x=e.clientX/this.SCREEN_WIDTH*2-1,this.mouse.y=-e.clientY/this.SCREEN_HEIGHT*2+1;var t=new THREE.Vector3(this.mouse.x,this.mouse.y,1).unproject(this.camera),i=new THREE.Raycaster(this.camera.position,t.sub(this.camera.position).normalize()).intersectObjects(this.targetList);if(i.length>0){var s=i[0].object;"function"==typeof s.toggle&&s.toggle(s)}},closeCabinet:function(e){console.log("closeCabinet")},openCabinet:function(e){this.setTheRouterStatus({cabinetId:e.info.uuid}),this.$router.push({name:"dailyMainJiGui"}),console.log("openCabinet")},hoverCabinet:function(e){console.log("hoverCabinet")},closeServer:function(e){console.log("closeServer")},openServer:function(e){console.log("openServer")},hoverServer:function(e){console.log("hoverServer")},getWebsocketMsg:function(e){if(!this.fristBack&&e.length>0){var t=!0,i=!1,s=void 0;try{for(var r,a=o()(e);!(t=(r=a.next()).done);t=!0){var c=r.value,h=c,l=c,p=h.size.w,u=h.size.d,d=h.position.x,E=h.position.y,m=h.position.z;if(l&&l.servers)for(var v=0;v<l.servers.length;v++)this.createServer(p-4,4,u-4,d,E+9*(v+1),m+2,l.servers[v].device.status)}}catch(e){i=!0,s=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw s}}}return this.fristBack&&e.length>0&&(this.init(e),this.animate()),new n.a(function(e,t){e()})}}),mounted:function(){var e="东莞"===this.showType?"/wukangscreen/daCentreTopFengGRoomViewWebSocket/admin":"深圳"===this.showType?"/wukangscreen/daCentreTopHouHRoomViewWebSocket/admin":"/wukangscreen/daCentreTopJingQRoomViewWebSocket/admin";this.wsuri=BaseUrl.dailyCenterMain.JingFangWebsockUrl+e}},v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("section",{staticClass:"mainBox",style:{backgroundImage:" url("+this.backgroundImage+")"}},[t("section",{staticClass:"mapTitle"},[this._v("\n    "+this._s("东莞"===this.showType?"东莞凤岗机房俯视图":"深圳"===this.showType?"深圳后海机房俯视图":"上海金桥机房俯视图")+"\n  ")]),this._v(" "),t("section",{staticClass:"mapPoint",attrs:{id:this.container}})])},staticRenderFns:[]};var T=i("VU/8")(m,v,!1,function(e){i("AARu")},"data-v-bfad7f88",null);t.default=T.exports}});
//# sourceMappingURL=16.2d89e56a3a51b624be96.js.map